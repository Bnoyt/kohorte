{% load static %}

  <!--   Core JS Files   -->
    <script src="{% static 'js/jquery-3.2.1.js' %}" type="text/javascript"></script>
	<script src="{% static 'js/bootstrap.min.js' %}" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="{% static 'js/bootstrap-checkbox-radio.js' %}"></script>

    <!--  Notifications Plugin    -->
    <script src="{% static 'js/bootstrap-notify.js' %}"></script>

    <!-- Paper Dashboard Core javascript and methods for Demo purpose -->
	<script src="{% static 'js/paper-dashboard.js' %}"></script>



	<script type="text/javascript">




    {% if etat_connexion %}

    notification();

    {% endif %}



        	


	</script>


    <script>





function notification(){
        $.notify({
            message: "Combinaison mot de passe / pseudo erronnée"

        },{
            type: 'danger',
            timer: 4000,
            placement: {
                from: 'top',
                align: 'center'
            }
        });
    };

function show_posts(id){
    var a = $('#c_' + id);
    var h = $('#h_' + id);
    var s = $('#s_' + id);
    if (a.is(":visible")){
        a.hide(100);
        h.hide();
        s.show();

    } else {
        a.show(100);
        s.hide();
        h.show();

    }



};




function deplacer_modal(){
    $('body').prepend($('.modal'));
}

function notifier(message,type){
    $.notify({
            message: message

        },{
            type: type,
            timer: 100,
            placement: {
                from: 'top',
                align: 'center'
            }
        });
}



$(document).ready(function(){

    var id_noeud = 0;
    var id_question = 0;

    {% if noeud %}

    id_noeud = {{noeud.id}};

    {% endif %}

    {% if question %}

    id_question = {{question.id}};

    {% endif %}
        
    deplacer_modal();

    crsftoken = $("[name='csrfmiddlewaretoken']").val();



    function ajout_post(post,id_pere){
        setTimeout(function(){location.reload();},1000);


    }

    function retour_ajout_post(reponse){
        $('#id_titre').val('');
        $('#id_contenu').val('');
        var message;
        var type;
        var text = reponse['texte'];
        var post = reponse['post'];

        $('body,html').scrollTop(354354354);

        if (text=="succes"){
            
            message = "Post ajouté avec succès";
            type = 'success';
            notifier(message,type);
            ajout_post(post,"fildepost");


        } else {
            type = "danger";
            if (text=='pasdecontenu'){
                message = 'Il manque le corps de votre post !';
            }
            else if (text=='titre'){
                message = 'Il manque le titre de votre post !';
            }
            else {
                message = 'Soyez serieux, faites un vrai post, tout de même !';
            }
            notifier(message,type);
        
        }
        

       
        

    }


     function retour_ajout_commentaire(reponse){
        var message;
        var type;
        var text = reponse['texte'];
        var commentaire = reponse['post'];
        var id_pere = reponse['id_pere'];


        if (text=="succes"){
            message = "Commentaire ajouté avec succès";
            type = 'success';
            notifier(message,type);
            ajout_post(commentaire,id_pere);
            


        } else {
            type = "danger";
            message = "Il faut écrire quelque chose si vous voulez commenter ce post";
            notifier(message,type);
        
        }
        

       
        

    }


    $("#form_button").click(function(event){

        event.preventDefault();

        titre = $('#id_titre').val();

        contenu = $('#id_contenu').val();

        

        $.post('{% url "ajouter_post" %}',{csrfmiddlewaretoken:crsftoken,noeud:1,titre:titre,contenu:contenu,id_noeud:id_noeud,id_question:id_question},retour_ajout_post,'json');




    });



    $(".btn-comment").click(

        function() {

            
            champ = $(this).parent().next();


            if(champ.is(":visible")){
                champ.hide();
            } else {
                champ.show();
            }
        


        });

    $(".form-commentaire").submit(function(event){
        event.preventDefault();
        formulaire = $(this);
        texte_input = formulaire.children(".commentaire");
        contenu = texte_input.val();
        texte_input.val('');
        suivant = formulaire.parent().parent().next();
        pere = suivant.attr('id');

         $.post('{% url "ajouter_commentaire" %}',{csrfmiddlewaretoken:crsftoken,noeud:1,pere:pere,contenu:contenu,id_noeud:id_noeud,id_question:id_question},retour_ajout_commentaire,'json');




        });

    $(".form-reponse").submit(function(event){
        event.preventDefault();
        formulaire = $(this);
        texte_input = formulaire.children(".reponse");
        contenu = texte_input.val();
        texte_input.val('');
        suivant = formulaire.parent().parent().next();
        pere = suivant.attr('id');

         $.post('{% url "ajouter_reponse" %}',{csrfmiddlewaretoken:crsftoken,noeud:1,pere:pere,contenu:contenu,id_noeud:id_noeud,id_question:id_question},retour_ajout_commentaire,'json');




        });

});






    </script>



</html>